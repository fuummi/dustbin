const shell = require('shelljs');
const fs = require('fs')

class myPlugin {
    constructor(options) {
        this.options = options;
    }
    apply(compiler) {
        let data = ''
        let paths = this.options.path
        shell.exec('git log', { silent: true }, function (code, stdout, stderr) { //用shelljs的exec来执行git log命令
            if (stdout !== "") { //获取命令行输出的数据
                data = stdout
            } else {
                data = stderr
            }
            const dirname = path.resolve('./dist')
            if (!fs.existsSync(dirname)) { //不存在文件夹则创建
                fs.mkdir(dirname, err => { })
            }
            fs.writeFileSync(`${paths}/readme.md`, data, (err) => { console.log(err); }) //写入文件
        })
    }
}

module.exports = myPlugin